
#include "../80211core/cprecomp.h"

typedef struct {
	u32_t	ackrcv_bad;
	u32_t	rts_bad;
	u32_t	rts_good;
	u32_t	fcs_bad;
	u32_t	beacons;
} ZM_HAL_MIB_STATS;


typedef struct {
	u32_t	ns_avgbrssi;	
	u32_t	ns_avgrssi;	    
	u32_t	ns_avgtxrssi;	
} ZM_HAL_NODE_STATS;

#define	ZM_HAL_RSSI_EP_MULTIPLIER	(1<<7)	

struct zsAniStats {
    u32_t   ast_ani_niup;   
    u32_t   ast_ani_nidown; 
    u32_t   ast_ani_spurup; 
    u32_t   ast_ani_spurdown;
    u32_t   ast_ani_ofdmon; 
    u32_t   ast_ani_ofdmoff;
    u32_t   ast_ani_cckhigh;
    u32_t   ast_ani_ccklow; 
    u32_t   ast_ani_stepup; 
    u32_t   ast_ani_stepdown;
    u32_t   ast_ani_ofdmerrs;
    u32_t   ast_ani_cckerrs;
    u32_t   ast_ani_reset;  
    u32_t   ast_ani_lzero;  
    u32_t   ast_ani_lneg;   
    ZM_HAL_MIB_STATS   ast_mibstats;   
    ZM_HAL_NODE_STATS  ast_nodestats;  
};


struct zsAniState {
    ZM_HAL_CHANNEL c;
    u8_t    noiseImmunityLevel;
    u8_t    spurImmunityLevel;
    u8_t    firstepLevel;
    u8_t    ofdmWeakSigDetectOff;
    u8_t    cckWeakSigThreshold;

    
    u32_t   listenTime;
    u32_t   ofdmTrigHigh;
    u32_t   ofdmTrigLow;
    s32_t   cckTrigHigh;
    s32_t   cckTrigLow;
    s32_t   rssiThrLow;
    s32_t   rssiThrHigh;

    u32_t   noiseFloor; 
    u32_t   txFrameCount;   
    u32_t   rxFrameCount;   
    u32_t   cycleCount; 
    u32_t   ofdmPhyErrCount;
    u32_t   cckPhyErrCount; 
    u32_t   ofdmPhyErrBase; 
    u32_t   cckPhyErrBase;  
    s16_t   pktRssi[2]; 
    s16_t   ofdmErrRssi[2]; 
    s16_t   cckErrRssi[2];  
};

typedef enum {
	ZM_HAL_ANI_PRESENT,			
	ZM_HAL_ANI_NOISE_IMMUNITY_LEVEL,		
	ZM_HAL_ANI_OFDM_WEAK_SIGNAL_DETECTION,	
	ZM_HAL_ANI_CCK_WEAK_SIGNAL_THR,		
	ZM_HAL_ANI_FIRSTEP_LEVEL,			
	ZM_HAL_ANI_SPUR_IMMUNITY_LEVEL,		
	ZM_HAL_ANI_MODE,				
	ZM_HAL_ANI_PHYERR_RESET,			
} ZM_HAL_ANI_CMD;

#define AR_PHY_COUNTMAX        (3 << 22)         
#define ZM_HAL_PROCESS_ANI     0x00000001  
#define ZM_RSSI_DUMMY_MARKER	0x127


#define AR_PHY_BASE     0x1C5800      
#define AR_PHY(_n)      (AR_PHY_BASE + ((_n)<<2))

#define AR_PHY_TEST             0x1C5800          
#define PHY_AGC_CLR             0x10000000      
#define RFSILENT_BB             0x00002000      

#define AR_PHY_TURBO        0x1C5804      
#define AR_PHY_FC_TURBO_MODE        0x00000001  
#define AR_PHY_FC_TURBO_SHORT       0x00000002  
#define AR_PHY_FC_DYN2040_EN        0x00000004      
#define AR_PHY_FC_DYN2040_PRI_ONLY      0x00000008      
#define AR_PHY_FC_DYN2040_PRI_CH    0x00000010      
#define AR_PHY_FC_DYN2040_EXT_CH        0x00000020      
#define AR_PHY_FC_HT_EN             0x00000040      
#define AR_PHY_FC_SHORT_GI_40       0x00000080      
#define AR_PHY_FC_WALSH             0x00000100      
#define AR_PHY_FC_SINGLE_HT_LTF1        0x00000200      

#define AR_PHY_TIMING2      0x1C5810      
#define AR_PHY_TIMING2_USE_FORCE    0x00001000
#define AR_PHY_TIMING2_FORCE_VAL    0x00000fff

#define AR_PHY_TIMING3      0x1C5814      
#define AR_PHY_TIMING3_DSC_MAN  0xFFFE0000
#define AR_PHY_TIMING3_DSC_MAN_S    17
#define AR_PHY_TIMING3_DSC_EXP  0x0001E000
#define AR_PHY_TIMING3_DSC_EXP_S    13

#define AR_PHY_CHIP_ID          0x1C5818      
#define AR_PHY_CHIP_ID_REV_0    0x80        
#define AR_PHY_CHIP_ID_REV_1    0x81        

#define AR_PHY_ACTIVE       0x1C581C      
#define AR_PHY_ACTIVE_EN    0x00000001  
#define AR_PHY_ACTIVE_DIS   0x00000000  

#define AR_PHY_RF_CTL2                      0x1C5824
#define AR_PHY_TX_END_DATA_START  0x000000FF
#define AR_PHY_TX_END_DATA_START_S  0
#define AR_PHY_TX_END_PA_ON       0x0000FF00
#define AR_PHY_TX_END_PA_ON_S       8


#define AR_PHY_RF_CTL3                  0x1C5828
#define AR_PHY_TX_END_TO_A2_RX_ON       0x00FF0000
#define AR_PHY_TX_END_TO_A2_RX_ON_S     16

#define AR_PHY_ADC_CTL      0x1C582C
#define AR_PHY_ADC_CTL_OFF_INBUFGAIN    0x00000003
#define AR_PHY_ADC_CTL_OFF_INBUFGAIN_S  0
#define AR_PHY_ADC_CTL_OFF_PWDDAC   0x00002000
#define AR_PHY_ADC_CTL_OFF_PWDBANDGAP   0x00004000 
#define AR_PHY_ADC_CTL_OFF_PWDADC   0x00008000 
#define AR_PHY_ADC_CTL_ON_INBUFGAIN 0x00030000
#define AR_PHY_ADC_CTL_ON_INBUFGAIN_S   16

#define AR_PHY_ADC_SERIAL_CTL       0x1C5830
#define AR_PHY_SEL_INTERNAL_ADDAC   0x00000000
#define AR_PHY_SEL_EXTERNAL_RADIO   0x00000001

#define AR_PHY_RF_CTL4                    0x1C5834
#define AR_PHY_RF_CTL4_TX_END_XPAB_OFF    0xFF000000
#define AR_PHY_RF_CTL4_TX_END_XPAB_OFF_S  24
#define AR_PHY_RF_CTL4_TX_END_XPAA_OFF    0x00FF0000
#define AR_PHY_RF_CTL4_TX_END_XPAA_OFF_S  16
#define AR_PHY_RF_CTL4_FRAME_XPAB_ON      0x0000FF00
#define AR_PHY_RF_CTL4_FRAME_XPAB_ON_S    8
#define AR_PHY_RF_CTL4_FRAME_XPAA_ON      0x000000FF
#define AR_PHY_RF_CTL4_FRAME_XPAA_ON_S    0

#define AR_PHY_SETTLING     0x1C5844
#define AR_PHY_SETTLING_SWITCH  0x00003F80
#define AR_PHY_SETTLING_SWITCH_S    7

#define AR_PHY_RXGAIN       0x1C5848
#define AR_PHY_RXGAIN_TXRX_ATTEN    0x0003F000
#define AR_PHY_RXGAIN_TXRX_ATTEN_S  12
#define AR_PHY_RXGAIN_TXRX_RF_MAX   0x007C0000
#define AR_PHY_RXGAIN_TXRX_RF_MAX_S 18

#define AR_PHY_DESIRED_SZ   0x1C5850
#define AR_PHY_DESIRED_SZ_ADC       0x000000FF
#define AR_PHY_DESIRED_SZ_ADC_S     0
#define AR_PHY_DESIRED_SZ_PGA       0x0000FF00
#define AR_PHY_DESIRED_SZ_PGA_S     8
#define AR_PHY_DESIRED_SZ_TOT_DES   0x0FF00000
#define AR_PHY_DESIRED_SZ_TOT_DES_S 20

#define AR_PHY_FIND_SIG      0x1C5858
#define AR_PHY_FIND_SIG_FIRSTEP  0x0003F000
#define AR_PHY_FIND_SIG_FIRSTEP_S        12
#define AR_PHY_FIND_SIG_FIRPWR   0x03FC0000
#define AR_PHY_FIND_SIG_FIRPWR_S         18

#define AR_PHY_AGC_CTL1      0x1C585C
#define AR_PHY_AGC_CTL1_COARSE_LOW       0x00007F80
#define AR_PHY_AGC_CTL1_COARSE_LOW_S         7
#define AR_PHY_AGC_CTL1_COARSE_HIGH      0x003F8000
#define AR_PHY_AGC_CTL1_COARSE_HIGH_S        15

#define AR_PHY_AGC_CONTROL  0x1C5860      
#define AR_PHY_AGC_CONTROL_CAL  0x00000001  
#define AR_PHY_AGC_CONTROL_NF   0x00000002  

#define AR_PHY_CCA              0x1C5864
#define AR_PHY_MINCCA_PWR       0x1FF00000
#define AR_PHY_MINCCA_PWR_S     19
#define AR_PHY_CCA_THRESH62     0x0007F000
#define AR_PHY_CCA_THRESH62_S   12

#define AR_PHY_SFCORR_LOW    0x1C586C
#define AR_PHY_SFCORR_LOW_USE_SELF_CORR_LOW  0x00000001
#define AR_PHY_SFCORR_LOW_M2COUNT_THR_LOW    0x00003F00
#define AR_PHY_SFCORR_LOW_M2COUNT_THR_LOW_S  8
#define AR_PHY_SFCORR_LOW_M1_THRESH_LOW  0x001FC000
#define AR_PHY_SFCORR_LOW_M1_THRESH_LOW_S    14
#define AR_PHY_SFCORR_LOW_M2_THRESH_LOW  0x0FE00000
#define AR_PHY_SFCORR_LOW_M2_THRESH_LOW_S    21

#define AR_PHY_SFCORR       0x1C5868
#define AR_PHY_SFCORR_M2COUNT_THR    0x0000001F
#define AR_PHY_SFCORR_M2COUNT_THR_S  0
#define AR_PHY_SFCORR_M1_THRESH  0x00FE0000
#define AR_PHY_SFCORR_M1_THRESH_S    17
#define AR_PHY_SFCORR_M2_THRESH  0x7F000000
#define AR_PHY_SFCORR_M2_THRESH_S    24

#define AR_PHY_SLEEP_CTR_CONTROL    0x1C5870
#define AR_PHY_SLEEP_CTR_LIMIT      0x1C5874
#define AR_PHY_SLEEP_SCAL       0x1C5878

#define AR_PHY_PLL_CTL          0x1C587c      
#define AR_PHY_PLL_CTL_40       0xaa        
#define AR_PHY_PLL_CTL_40_5413  0x04
#define AR_PHY_PLL_CTL_44       0xab        
#define AR_PHY_PLL_CTL_44_2133  0xeb        
#define AR_PHY_PLL_CTL_40_2133  0xea        

#define AR_PHY_RX_DELAY     0x1C5914      
#define AR_PHY_RX_DELAY_DELAY   0x00003FFF  

#define AR_PHY_TIMING_CTRL4     0x1C5920      
#define AR_PHY_TIMING_CTRL4_IQCORR_Q_Q_COFF 0x01F   
#define AR_PHY_TIMING_CTRL4_IQCORR_Q_Q_COFF_S   0   
#define AR_PHY_TIMING_CTRL4_IQCORR_Q_I_COFF 0x7E0   
#define AR_PHY_TIMING_CTRL4_IQCORR_Q_I_COFF_S   5   
#define AR_PHY_TIMING_CTRL4_IQCORR_ENABLE   0x800   
#define AR_PHY_TIMING_CTRL4_IQCAL_LOG_COUNT_MAX 0xF000  
#define AR_PHY_TIMING_CTRL4_IQCAL_LOG_COUNT_MAX_S   12  
#define AR_PHY_TIMING_CTRL4_DO_IQCAL    0x10000     

#define AR_PHY_TIMING5      0x1C5924
#define AR_PHY_TIMING5_CYCPWR_THR1  0x000000FE
#define AR_PHY_TIMING5_CYCPWR_THR1_S    1

#define AR_PHY_POWER_TX_RATE1   0x1C5934
#define AR_PHY_POWER_TX_RATE2   0x1C5938
#define AR_PHY_POWER_TX_RATE_MAX    0x1C593c
#define AR_PHY_POWER_TX_RATE_MAX_TPC_ENABLE 0x00000040

#define AR_PHY_FRAME_CTL    0x1C5944
#define AR_PHY_FRAME_CTL_TX_CLIP    0x00000038
#define AR_PHY_FRAME_CTL_TX_CLIP_S  3

#define AR_PHY_TXPWRADJ     0x1C594C      
#define AR_PHY_TXPWRADJ_CCK_GAIN_DELTA  0x00000FC0
#define AR_PHY_TXPWRADJ_CCK_GAIN_DELTA_S    6
#define AR_PHY_TXPWRADJ_CCK_PCDAC_INDEX 0x00FC0000
#define AR_PHY_TXPWRADJ_CCK_PCDAC_INDEX_S   18

#define AR_PHY_RADAR_0      0x1C5954      
#define AR_PHY_RADAR_0_ENA  0x00000001  
#define AR_PHY_RADAR_0_INBAND   0x0000003e  
#define AR_PHY_RADAR_0_INBAND_S 1
#define AR_PHY_RADAR_0_PRSSI    0x00000FC0  
#define AR_PHY_RADAR_0_PRSSI_S  6
#define AR_PHY_RADAR_0_HEIGHT   0x0003F000  
#define AR_PHY_RADAR_0_HEIGHT_S 12
#define AR_PHY_RADAR_0_RRSSI    0x00FC0000  
#define AR_PHY_RADAR_0_RRSSI_S  18
#define AR_PHY_RADAR_0_FIRPWR   0x7F000000  
#define AR_PHY_RADAR_0_FIRPWR_S 24

#define AR_PHY_SWITCH_CHAIN_0     0x1C5960
#define AR_PHY_SWITCH_COM         0x1C5964

#define AR_PHY_SIGMA_DELTA  0x1C596C      
#define AR_PHY_SIGMA_DELTA_ADC_SEL  0x00000003
#define AR_PHY_SIGMA_DELTA_ADC_SEL_S    0
#define AR_PHY_SIGMA_DELTA_FILT2    0x000000F8
#define AR_PHY_SIGMA_DELTA_FILT2_S  3
#define AR_PHY_SIGMA_DELTA_FILT1    0x00001F00
#define AR_PHY_SIGMA_DELTA_FILT1_S  8
#define AR_PHY_SIGMA_DELTA_ADC_CLIP 0x01FFE000
#define AR_PHY_SIGMA_DELTA_ADC_CLIP_S   13

#define AR_PHY_RESTART      0x1C5970      
#define AR_PHY_RESTART_DIV_GC   0x001C0000  
#define AR_PHY_RESTART_DIV_GC_S 18

#define AR_PHY_RFBUS_REQ        0x1C597C
#define AR_PHY_RFBUS_REQ_EN     0x00000001

#define AR_PHY_RX_CHAINMASK     0x1C59a4

#define AR_PHY_EXT_CCA          0x1C59bc
#define AR_PHY_EXT_MINCCA_PWR   0xFF800000
#define AR_PHY_EXT_MINCCA_PWR_S 23

#define AR_PHY_HALFGI           0x1C59D0      
#define AR_PHY_HALFGI_DSC_MAN   0x0007FFF0
#define AR_PHY_HALFGI_DSC_MAN_S 4
#define AR_PHY_HALFGI_DSC_EXP   0x0000000F
#define AR_PHY_HALFGI_DSC_EXP_S 0

#define AR_PHY_HEAVY_CLIP_ENABLE    0x1C59E0

#define AR_PHY_M_SLEEP      0x1C59f0      
#define AR_PHY_REFCLKDLY    0x1C59f4
#define AR_PHY_REFCLKPD     0x1C59f8


#define AR_PHY_IQCAL_RES_PWR_MEAS_I 0x1C5C10  
#define AR_PHY_IQCAL_RES_PWR_MEAS_Q 0x1C5C14  
#define AR_PHY_IQCAL_RES_IQ_CORR_MEAS   0x1C5C18  

#define AR_PHY_CURRENT_RSSI 0x1C5C1c      

#define AR_PHY_RFBUS_GRANT       0x1C5C20
#define AR_PHY_RFBUS_GRANT_EN    0x00000001

#define AR_PHY_MODE     0x1C6200  
#define AR_PHY_MODE_AR2133  0x08    
#define AR_PHY_MODE_AR5111  0x00    
#define AR_PHY_MODE_AR5112  0x08    
#define AR_PHY_MODE_DYNAMIC 0x04    
#define AR_PHY_MODE_RF2GHZ  0x02    
#define AR_PHY_MODE_RF5GHZ  0x00    
#define AR_PHY_MODE_CCK     0x01    
#define AR_PHY_MODE_OFDM    0x00    

#define AR_PHY_CCK_TX_CTRL  0x1C6204
#define AR_PHY_CCK_TX_CTRL_JAPAN    0x00000010

#define AR_PHY_CCK_DETECT                           0x1C6208
#define AR_PHY_CCK_DETECT_WEAK_SIG_THR_CCK          0x0000003F
#define AR_PHY_CCK_DETECT_WEAK_SIG_THR_CCK_S        0
#define AR_PHY_CCK_DETECT_ANT_SWITCH_TIME           0x00001FC0 
#define AR_PHY_CCK_DETECT_ANT_SWITCH_TIME_S         6
#define AR_PHY_CCK_DETECT_BB_ENABLE_ANT_FAST_DIV    0x2000

#define AR_PHY_GAIN_2GHZ    0x1C620C
#define AR_PHY_GAIN_2GHZ_RXTX_MARGIN    0x00FC0000
#define AR_PHY_GAIN_2GHZ_RXTX_MARGIN_S  18
#define AR_PHY_GAIN_2GHZ_BSW_MARGIN     0x00003C00
#define AR_PHY_GAIN_2GHZ_BSW_MARGIN_S   10
#define AR_PHY_GAIN_2GHZ_BSW_ATTEN      0x0000001F
#define AR_PHY_GAIN_2GHZ_BSW_ATTEN_S    0

#define AR_PHY_CCK_RXCTRL4  0x1C621C
#define AR_PHY_CCK_RXCTRL4_FREQ_EST_SHORT   0x01F80000
#define AR_PHY_CCK_RXCTRL4_FREQ_EST_SHORT_S 19

#define AR_PHY_DAG_CTRLCCK  0x1C6228
#define AR_PHY_DAG_CTRLCCK_EN_RSSI_THR  0x00000200 
#define AR_PHY_DAG_CTRLCCK_RSSI_THR 0x0001FC00 
#define AR_PHY_DAG_CTRLCCK_RSSI_THR_S   10     

#define AR_PHY_POWER_TX_RATE3   0x1C6234
#define AR_PHY_POWER_TX_RATE4   0x1C6238

#define AR_PHY_SCRM_SEQ_XR  0x1C623C
#define AR_PHY_HEADER_DETECT_XR 0x1C6240
#define AR_PHY_CHIRP_DETECTED_XR    0x1C6244
#define AR_PHY_BLUETOOTH    0x1C6254

#define AR_PHY_TPCRG1   0x1C6258  
#define AR_PHY_TPCRG1_NUM_PD_GAIN   0x0000c000
#define AR_PHY_TPCRG1_NUM_PD_GAIN_S 14

#define AR_PHY_TPCRG1_PD_GAIN_1    0x00030000
#define AR_PHY_TPCRG1_PD_GAIN_1_S  16
#define AR_PHY_TPCRG1_PD_GAIN_2    0x000C0000
#define AR_PHY_TPCRG1_PD_GAIN_2_S  18
#define AR_PHY_TPCRG1_PD_GAIN_3    0x00300000
#define AR_PHY_TPCRG1_PD_GAIN_3_S  20


#define AR_PHY_ANALOG_SWAP      0xa268
#define AR_PHY_SWAP_ALT_CHAIN   0x00000040

#define AR_PHY_TPCRG5   0x1C626C 
#define AR_PHY_TPCRG5_PD_GAIN_OVERLAP   0x0000000F
#define AR_PHY_TPCRG5_PD_GAIN_OVERLAP_S     0
#define AR_PHY_TPCRG5_PD_GAIN_BOUNDARY_1    0x000003F0
#define AR_PHY_TPCRG5_PD_GAIN_BOUNDARY_1_S  4
#define AR_PHY_TPCRG5_PD_GAIN_BOUNDARY_2    0x0000FC00
#define AR_PHY_TPCRG5_PD_GAIN_BOUNDARY_2_S  10
#define AR_PHY_TPCRG5_PD_GAIN_BOUNDARY_3    0x003F0000
#define AR_PHY_TPCRG5_PD_GAIN_BOUNDARY_3_S  16
#define AR_PHY_TPCRG5_PD_GAIN_BOUNDARY_4    0x0FC00000
#define AR_PHY_TPCRG5_PD_GAIN_BOUNDARY_4_S  22

#define AR_PHY_POWER_TX_RATE5   0x1C638C
#define AR_PHY_POWER_TX_RATE6   0x1C6390

#define AR_PHY_CAL_CHAINMASK    0x1C639C

#define AR_PHY_POWER_TX_SUB     0x1C63C8
#define AR_PHY_POWER_TX_RATE7   0x1C63CC
#define AR_PHY_POWER_TX_RATE8   0x1C63D0
#define AR_PHY_POWER_TX_RATE9   0x1C63D4
